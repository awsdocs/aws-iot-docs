# Functions<a name="iot-sql-functions"></a>

You can use the following built\-in functions in the SELECT or WHERE clauses of your SQL expressions\.

## abs\(Decimal\)<a name="iot-func-abs"></a>

Returns the absolute value of a number\. Supported by SQL version 2015\-10\-08 and later\.

Example: `abs(-5)` returns 5\.


****  

| Argument type | Result | 
| --- | --- | 
| Int | Int, the absolute value of the argument\. | 
| Decimal | Decimal, the absolute value of the argument\. | 
| Boolean | Undefined\. | 
| String | Decimal\. The result is the absolute value of the argument\. If the string cannot be converted, the result is Undefined\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## Accountid\(\)<a name="iot-sql-function-accountid"></a>

Returns the ID of the account that owns this rule as a `String`\. Supported by SQL version 2015\-10\-08 and later\.

Example:

`accountid() ` = "123456789012"

## acos\(Decimal\)<a name="iot-func-acos"></a>

Returns the inverse cosine of a number in radians\. `Decimal` arguments are rounded to double precision before function application\. Supported by SQL version 2015\-10\-08 and later\.

Example: `acos(0)` = 1\.5707963267948966 


****  

| Argument type | Result | 
| --- | --- | 
| Int | Decimal \(with double precision\), the inverse cosine of the argument\. Imaginary results are returned as Undefined\. | 
| Decimal | Decimal \(with double precision\), the inverse cosine of the argument\. Imaginary results are returned as Undefined\. | 
| Boolean | Undefined\. | 
| String | Decimal, the inverse cosine of the argument\. If the string cannot be converted, the result is Undefined\. Imaginary results are returned as Undefined\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## asin\(Decimal\)<a name="iot-func-asin"></a>

Returns the inverse sine of a number in radians\. `Decimal` arguments are rounded to double precision before function application\. Supported by SQL version 2015\-10\-08 and later\.

Example: `asin(0)` = 0\.0


****  

| Argument type | Result | 
| --- | --- | 
| Int | Decimal \(with double precision\), the inverse sine of the argument\. Imaginary results are returned as Undefined\. | 
| Decimal | Decimal \(with double precision\), the inverse sine of the argument\. Imaginary results are returned as Undefined\. | 
| Boolean | Undefined\. | 
| String | Decimal \(with double precision\), the inverse sine of the argument\. If the string cannot be converted, the result is Undefined\. Imaginary results are returned as Undefined\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## atan\(Decimal\)<a name="iot-func-atan"></a>

Returns the inverse tangent of a number in radians\. `Decimal` arguments are rounded to double precision before function application\. Supported by SQL version 2015\-10\-08 and later\.

Example: `atan(0)` = 0\.0


****  

| Argument type | Result | 
| --- | --- | 
| Int | Decimal \(with double precision\), the inverse tangent of the argument\. Imaginary results are returned as Undefined\. | 
| Decimal | Decimal \(with double precision\), the inverse tangent of the argument\. Imaginary results are returned as Undefined\. | 
| Boolean | Undefined\. | 
| String | Decimal, the inverse tangent of the argument\. If the string cannot be converted, the result is Undefined\. Imaginary results are returned as Undefined\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## atan2\(Decimal, decimal\)<a name="iot-func-atan2"></a>

Returns the angle, in radians, between the positive x\-axis and the \(x, y\) point defined in the two arguments\.  The angle is positive for counter\-clockwise angles \(upper half\-plane, y > 0\), and negative for clockwise angles \(lower half\-plane, y < 0\)\. `Decimal` arguments are rounded to double precision before function application\. Supported by SQL version 2015\-10\-08 and later\. 

Example: `atan2(1, 0)` = 1\.5707963267948966


****  

| Argument type | Argument type | Result | 
| --- | --- | --- | 
| Int/Decimal | Int/Decimal | Decimal \(with double precision\), the angle between the x\-axis and the specified \(x,y\) point\. | 
| Int/Decimal/String | Int/Decimal/String | Decimal, the inverse tangent of the point described\. If a string cannot be converted, the result is Undefined\. | 
| Other Value | Other Value | Undefined\. | 

## aws\_lambda\(functionArn, inputJson\)<a name="iot-func-aws-lambda"></a>

 Calls the specified Lambda function passing `inputJson` to the Lambda function and returns the JSON generated by the Lambda function\.


**Arguments**  

| Argument | Description | 
| --- | --- | 
| functionArn |  The ARN of the Lambda function to call\. The Lambda function must return JSON data\.  | 
| inputJson |  The JSON input passed to the Lambda function\.  | 

You must grant AWS IoT `lambda:InvokeFunction` permissions to invoke the specified Lambda function\. The following example shows how to grant the `lambda:InvokeFunction` permission using the AWS CLI:

```
aws lambda add-permission --function-name "function_name"
--region "region"
--principal iot.amazonaws.com 
--source-arn arn:aws:iot:us-east-1:account_id:rule/rule_name
--source-account "account_id"
--statement-id "unique_id" 
--action "lambda:InvokeFunction"
```

The following are the arguments for the add\-permission command:

\-\-function\-name   
Name of the Lambda function whose resource policy you are updating by adding a new permission\.

\-\-region  
The AWS Region of your account\.

\-\-principal  
The principal who is getting the permission\. This should be `iot.amazonaws.com` to allow AWS IoT permission to call a Lambda function\.

\-\-source\-arn  
The ARN of the rule\. You can use the get\-topic\-rule CLI command to get the ARN of a rule\.

\-\-source\-account  
The AWS account where the rule is defined\.

\-\-statement\-id  
A unique statement identifier\.

\-\-action  
The Lambda action you want to allow in this statement\. To allow AWS IoT to invoke a Lambda function, specify `lambda:InvokeFunction`\.

**Note**  
If you add a permission for an AWS IoT principal without providing the source ARN, any AWS account that creates a rule with your Lambda action can trigger rules to invoke your Lambda function from AWS IoT\. For more information, see [Lambda Permission Model](https://docs.aws.amazon.com/lambda/latest/dg/intro-permission-model.html)\.

Given a JSON message payload like:

```
{
    "attribute1": 21,
    "attribute2": "value"
}
```

The `aws_lambda` function can be used to call Lambda function as follows:

```
SELECT
aws_lambda("arn:aws:lambda:us-east-1:account_id:function:lambda_function", {"payload":attribute1}) as output FROM 'a/b'
```

If you want to pass the full MQTT message payload, you can specify the JSON payload using '\*'\. For example:

```
SELECT
aws_lambda("arn:aws:lambda:us-east-1:account_id:function:lambda_function", *) as output FROM 'a/b'
```

`payload.inner.element` selects data from message published on topic 'a/b'\.

`some.value` selects data from the output that is generated by the Lambda function\.

**Note**  
 The rules engine limits the execution duration of Lambda functions\. Lambda function calls from rules should be completed within 2000 milliseconds\. 

## bitand\(Int, int\)<a name="iot-func-bitand"></a>

Performs a bitwise AND on the bit representations of the two `Int`\(\-converted\) arguments\. Supported by SQL version 2015\-10\-08 and later\.

Example: `bitand(13, 5)` = 5


****  

| Argument type | Argument type | Result | 
| --- | --- | --- | 
| Int | Int | Int, a bitwise AND of the two arguments\. | 
| Int/Decimal | Int/Decimal | Int, a bitwise AND of the two arguments\. All non\-Int numbers are rounded down to the nearest Int\. If any of the arguments cannot be converted to an Int, the result is Undefined\. | 
| Int/Decimal/String | Int/Decimal/String | Int, a bitwise AND of the two arguments\. All strings are converted to decimals and are rounded down to the nearest Int\. If the conversion fails, the result is Undefined\. | 
| Other Value | Other Value | Undefined\. | 

## bitor\(Int, int\)<a name="iot-func-bitor"></a>

Performs a bitwise OR of the bit representations of the two arguments\. Supported by SQL version 2015\-10\-08 and later\.

Example: `bitor(8, 5)` = 13


****  

| Argument type | Argument type | Result | 
| --- | --- | --- | 
| Int | Int | Int, the bitwise OR of the two arguments\. | 
| Int/Decimal | Int/Decimal | Int, the bitwise OR of the two arguments\. All non\-Int numbers are rounded down to the nearest Int\. If the conversion fails, the result is Undefined\. | 
| Int/Decimal/String | Int/Decimal/String | Int, the bitwise OR on the two arguments\. All strings are converted to decimals and rounded down to the nearest Int\. If the conversion fails, the result is Undefined\. | 
| Other Value | Other Value | Undefined\. | 

## bitxor\(Int, int\)<a name="iot-func-xbitor"></a>

Performs a bitwise XOR on the bit representations of the two `Int`\(\-converted\) arguments\. Supported by SQL version 2015\-10\-08 and later\.

Example:`bitor(13, 5)` = 8


****  

| Argument type | Argument type | Result | 
| --- | --- | --- | 
| Int | Int | Int, a bitwise XOR on the two arguments\. | 
| Int/Decimal | Int/Decimal | Int, a bitwise XOR on the two arguments\. Non\-Int numbers are rounded down to the nearest Int\. | 
| Int/Decimal/String | Int/Decimal/String | Int, a bitwise XOR on the two arguments\. strings are converted to decimals and rounded down to the nearest Int\. If any conversion fails, the result is Undefined\. | 
| Other Value | Other Value | Undefined\. | 

## bitnot\(Int\)<a name="iot-func-bitnot"></a>

Performs a bitwise NOT on the bit representations of the `Int`\(\-converted\) argument\. Supported by SQL version 2015\-10\-08 and later\. 

Example: `bitnot(13)` = 2


****  

| Argument type | Result | 
| --- | --- | 
| Int | Int, a bitwise NOT of the argument\. | 
| Decimal | Int, a bitwise NOT of the argument\. The Decimal value is rounded down to the nearest Int\. | 
| String | Int, a bitwise NOT of the argument\. Strings are converted to decimals and rounded down to the nearest Int\. If any conversion fails, the result is Undefined\. | 
| Other Value | Other value\. | 

## Cast\(\)<a name="iot-sql-function-cast"></a>

Converts a value from one data type to another\. Cast behaves mostly like the standard conversions, with the addition of the ability to cast numbers to or from Booleans\. If AWS IoT cannot determine how to cast one type to another, the result is `Undefined`\. Supported by SQL version 2015\-10\-08 and later\. Format: cast\(*value* as *type*\)\.

Example:

`cast(true as Decimal) ` = 1\.0

The following keywords might appear after "as" when calling `cast`:


**For SQL version 2015\-10\-08 and 2016\-03\-23**  

| Keyword | Result | 
| --- | --- | 
| Decimal | Casts value to Decimal\. | 
| Bool | Casts value to Boolean\. | 
| Boolean | Casts value to Boolean\. | 
| String | Casts value to String\. | 
| Nvarchar | Casts value to String\. | 
| Text | Casts value to String\. | 
| Ntext | Casts value to String\. | 
| varchar | Casts value to String\. | 
| Int | Casts value to Int\. | 
| Integer | Casts value to Int\. | 


**Additionally, for SQL version 2016\-03\-23**  

| Keyword | Result | 
| --- | --- | 
| Decimal | Casts value to Decimal\. | 
| Bool | Casts value to Boolean\. | 
| Boolean | Casts value to Boolean\. | 

Casting rules:


**Cast to decimal**  

| Argument type | Result | 
| --- | --- | 
| Int | A Decimal with no decimal point\. | 
| Decimal | The source value\. | 
| Boolean | true = 1\.0, false = 0\.0\. | 
| String | Tries to parse the string as a Decimal\. AWS IoT attempts to parse strings matching the regex: ^\-?\\d\+\(\\\.\\d\+\)?\(\(?i\)E\-?\\d\+\)?$\. "0", "\-1\.2", "5E\-12" are all examples of strings that are converted automatically to decimals\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 


**Cast to int**  

| Argument type | Result | 
| --- | --- | 
| Int | The source value\. | 
| Decimal | The source value, rounded down to the nearest Int\. | 
| Boolean | true = 1\.0, false = 0\.0\. | 
| String | Tries to parse the string as a Decimal\. AWS IoT attempts to parse strings matching the regex: ^\-?\\d\+\(\\\.\\d\+\)?\(\(?i\)E\-?\\d\+\)?$\. "0", "\-1\.2", "5E\-12" are all examples of strings that are converted automatically to decimals\. AWS IoT attempts to convert the string to a Decimal and round down to the nearest Int\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 


**Cast to `Boolean`**  

| Argument type | Result | 
| --- | --- | 
| Int | 0 = False, any\_nonzero\_value = True\. | 
| Decimal | 0 = False, any\_nonzero\_value = True\. | 
| Boolean | The source value\. | 
| String | "true" = True and "false" = False \(case insensitive\)\. Other string values = Undefined\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 


**Cast to string**  

| Argument type | Result | 
| --- | --- | 
| Int | A string representation of the Int, in standard notation\. | 
| Decimal | A string representing the Decimal value, possibly in scientific notation\. | 
| Boolean | "true" or "false", all lowercase\. | 
| String | "true"=True and "false"=False \(case\-insensitive\)\. Other string values = Undefined\. | 
| Array | The array serialized to JSON\. The result string is a comma\-separated list enclosed in square brackets\. String is quoted\. Decimal, Int, and Boolean are not\. | 
| Object | The object serialized to JSON\. The JSON string is a comma\-separated list of key\-value pairs and begins and ends with curly braces\. String is quoted\. Decimal, Int, Boolean, and Null are not\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## ceil\(Decimal\)<a name="iot-func-ceil"></a>

Rounds the given `Decimal` up to the nearest `Int`\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`ceil(1.2)` = 2

`ceil(-1.2)` = \-1


****  

| Argument type | Result | 
| --- | --- | 
| Int | Int, the argument value\. | 
| Decimal | Int, the Decimal value rounded up to the nearest Int\. | 
| String | Int\. The string is converted to Decimal and rounded up to the nearest Int\. If the string cannot be converted to a Decimal, the result is Undefined\. | 
| Other Value | Undefined\. | 

## chr\(String\)<a name="iot-func-chr"></a>

Returns the ASCII character that corresponds to the given `Int` argument\. Supported by SQL version 2015\-10\-08 and later\.

Examples: 

`chr(65)` = "A"\.

`chr(49)` = "1"\.


****  

| Argument type | Result | 
| --- | --- | 
| Int | The character corresponding to the specified ASCII value\. If the argument is not a valid ASCII value, the result is Undefined\. | 
| Decimal | The character corresponding to the specified ASCII value\. The Decimal argument is rounded down to the nearest Int\. If the argument is not a valid ASCII value, the result is Undefined\. | 
| Boolean | Undefined\. | 
| String | If the String can be converted to a Decimal, it is rounded down to the nearest Int\. If the argument is not a valid ASCII value, the result is Undefined\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Other Value | Undefined\. | 

## Clientid\(\)<a name="iot-sql-function-clientid"></a>

Returns the ID of the MQTT client sending the message, or `n/a` if the message wasn't sent over MQTT\. Supported by SQL version 2015\-10\-08 and later\.

Example:

`clientid() ` = "123456789012"

## Concat\(\)<a name="iot-func-concat"></a>

Concatenates arrays or strings\. This function accepts any number of arguments and returns a `String` or an `Array`\. Supported by SQL version 2015\-10\-08 and later\.

Examples: 

`concat() ` = `Undefined`\.

`concat(1) ` = "1"\.

`concat([1, 2, 3], 4)` = \[1, 2, 3, 4\]\.

`concat([1, 2, 3], "hello")` = \[1, 2, 3, "hello"\]

`concat("con", "cat")` = "concat" 

`concat(1, "hello")` = "1hello"

`concat("he","is","man")` = "heisman"

`concat([1, 2, 3], "hello", [4, 5, 6])` = \[1, 2, 3, "hello", 4, 5, 6\]


****  

| Number of arguments | Result | 
| --- | --- | 
| 0 | Undefined\. | 
| 1 | The argument is returned unmodified\. | 
| 2\+ | If any argument is an `Array`, the result is a single array containing all of the arguments\. If no arguments are arrays, and at least one argument is a `String`, the result is the concatenation of the `String` representations of all the arguments\. Arguments are converted to strings using the standard conversions listed above\. \. | 

## cos\(Decimal\)<a name="iot-func-cos"></a>

Returns the cosine of a number in radians\. `Decimal` arguments are rounded to double precision before function application\. Supported by SQL version 2015\-10\-08 and later\.

Example: 

`cos(0)` = 1\.


****  

| Argument type | Result | 
| --- | --- | 
| Int | Decimal \(with double precision\), the cosine of the argument\. Imaginary results are returned as Undefined\. | 
| Decimal | Decimal \(with double precision\), the cosine of the argument\. Imaginary results are returned as Undefined\. | 
| Boolean | Undefined\. | 
| String | Decimal \(with double precision\), the cosine of the argument\. If the string cannot be converted to a Decimal, the result is Undefined\. Imaginary results are returned as Undefined\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## cosh\(Decimal\)<a name="iot-func-cosh"></a>

Returns the hyperbolic cosine of a number in radians\. `Decimal` arguments are rounded to double precision before function application\. Supported by SQL version 2015\-10\-08 and later\.

Example: `cosh(2.3)` = 5\.037220649268761\. 


****  

| Argument type | Result | 
| --- | --- | 
| Int | Decimal \(with double precision\), the hyperbolic cosine of the argument\. Imaginary results are returned as Undefined\. | 
| Decimal | Decimal \(with double precision\), the hyperbolic cosine of the argument\. Imaginary results are returned as Undefined\. | 
| Boolean | Undefined\. | 
| String | Decimal \(with double precision\), the hyperbolic cosine of the argument\. If the string cannot be converted to a Decimal, the result is Undefined\. Imaginary results are returned as Undefined\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## encode\(value, encodingScheme\)<a name="iot-sql-encode-payload"></a>

Use the `encode` function to encode the payload, which potentially might be non\-JSON data, into its string representation based on the encoding scheme\. Supported by SQL version 2016\-03\-23 and later\.

value  
Any of the valid expressions, as defined in [AWS IoT SQL reference](iot-sql-reference.md)\. You can specify \* to encode the entire payload, regardless of whether it's in JSON format\. If you supply an expression, the result of the evaluation is converted to a string before it is encoded\.

encodingScheme  
A literal string representing the encoding scheme you want to use\. Currently, only `'base64'` is supported\.

## endswith\(String, string\)<a name="iot-func-endswith"></a>

Returns a `Boolean` indicating whether the first `String` argument ends with the second `String` argument\. If either argument is `Null` or `Undefined`, the result is `Undefined`\. Supported by SQL version 2015\-10\-08 and later\.

Example: `endswith("cat","at")` = true\.


****  

| Argument type 1 | Argument type 2 | Result | 
| --- | --- | --- | 
| String | String | True if the first argument ends in the second argument\. Otherwise, false\. | 
| Other Value | Other Value | Both arguments are converted to strings using the standard conversion rules\. True if the first argument ends in the second argument\. Otherwise, false\. If either argument is Null or Undefined, the result is Undefined\. | 

## exp\(Decimal\)<a name="iot-func-exp"></a>

Returns e raised to the `Decimal` argument\. `Decimal` arguments are rounded to double precision before function application\. Supported by SQL version 2015\-10\-08 and later\.

Example: `exp(1)` = e\. 


****  

| Argument type | Result | 
| --- | --- | 
| Int | Decimal \(with double precision\), e ^ argument\. | 
| Decimal | Decimal \(with double precision\), e ^ argument\. | 
| String | Decimal \(with double precision\), e ^ argument\. If the String cannot be converted to a Decimal, the result is Undefined\.  | 
| Other Value | Undefined\. | 

## floor\(Decimal\)<a name="iot-func-floor"></a>

Rounds the given `Decimal` down to the nearest `Int`\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`floor(1.2)` = 1

`floor(-1.2)` = \-2


****  

| Argument type | Result | 
| --- | --- | 
| Int | Int, the argument value\. | 
| Decimal | Int, the Decimal value rounded down to the nearest Int\. | 
| String | Int\. The string is converted to Decimal and rounded down to the nearest Int\. If the string cannot be converted to a Decimal, the result is Undefined\. | 
| Other Value | Undefined\. | 

## Get<a name="iot-sql-function-get"></a>

Extracts a value from a collection\-like type \(Array, String, Object\)\. No conversion is applied to the first argument\. Conversion applies as documented in the table to the second argument\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`get(["a", "b", "c"], 1) ` = "b"

`get({"a":"b"}, "a")` = "b"

`get("abc", 1)` = "b"


****  

| Argument type 1 | Argument type 2 | Result | 
| --- | --- | --- | 
| Array | Any Type \(converted to Int\) | The item at the 0\-based index of the Array provided by the second argument \(converted to Int\)\. If the conversion is unsuccessful, the result is Undefined\. If the index is outside the bounds of the Array \(negative or >= array\.length\), the result is Undefined\. | 
| String | Any Type \(converted to Int\) | The character at the 0\-based index of the string provided by the second argument \(converted to Int\)\. If the conversion is unsuccessful, the result is Undefined\. If the index is outside the bounds of the string \(negative or >= string\.length\), the result is Undefined\. | 
| Object | String \(no conversion is applied\) | The value stored in the first argument object corresponding to the string key provided as the second argument\. | 
| Other Value | Any Value | Undefined\. | 

## get\_dynamodb\(tableName, partitionKeyName, partitionKeyValue, sortKeyName, sortKeyValue, roleArn\)<a name="iot-sql-function-get-dynamodb"></a>

Retrieves data from a DynamoDB table\. `get_dynamodb()` allows you to query a DynamoDB table while a rule is evaluated\. You can filter or augment message payloads using data retrieved from DynamoDB\. Supported by SQL version 2016\-03\-23 and later\.

`get_dynamodb()` takes the following parameters:

tableName  
The name of the DynamoDB table to query\.

partitionKeyName  
The name of the partition key\. For more information, see [ DynamoDB Keys](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.CoreComponents.html#HowItWorks.CoreComponents.PrimaryKey)\.

partitionKeyValue  
The value of the partition key used to identify a record\. For more information, see [ DynamoDB Keys](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.CoreComponents.html#HowItWorks.CoreComponents.PrimaryKey)\.

sortKeyName  
Optional\. The name of the sort key\. This parameter is required only if the DynamoDB table queried uses a composite key\. For more information, see [ DynamoDB Keys](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.CoreComponents.html#HowItWorks.CoreComponents.PrimaryKey)\.

sortKeyValue  
Optional\. The value of the sort key\. This parameter is required only if the DynamoDB table queried uses a composite key\. For more information, see [ DynamoDB Keys](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.CoreComponents.html#HowItWorks.CoreComponents.PrimaryKey)\.

roleArn  
The ARN of an IAM role that grants access to the DynamoDB table\. The rules engine assumes this role to access the DynamoDB table on your behalf\. Avoid using an overly permissive role\. Grant the role only those permissions required by the rule\. The following is an example policy that grants access to one DynamoDB table\.  

```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "dynamodb:GetItem",
            "Resource": "arn:aws:dynamodb:aws-region:account-id:table/table-name"
        }
    ]
}}
```

As an example of how you can use `get_dynamodb()`, say you have a DynamoDB table that contains device ID and location information for all of your devices connected to AWS IoT\. The following SELECT statement uses the `get_dynamodb()` function to retrieve the location for the specified device ID:

`SELECT *, get_dynamodb("InServiceDevices", "deviceId", id, "arn:aws:iam::12345678910:role/getdynamo").location AS location FROM 'some/topic' `

**Note**  
You can call `get_dynamodb()` a maximum of one time per SQL statement\. Calling `get_dynamodb()` multiple times in a single SQL statement causes the rule to terminate without invoking any actions\.
If `get_dynamodb()` returns more than 8 KB of data, the rule's action may not be invoked\.

## get\_thing\_shadow\(thingName, roleARN\)<a name="iot-sql-function-get-thing-shadow"></a>

Returns the shadow of the specified thing\. Supported by SQL version 2016\-03\-23 and later\.

thingName  
String: The name of the thing whose shadow you want to retrieve\.

roleArn  
String: A role ARN with `iot:GetThingShadow` permission\.

Example:

`SELECT * from 'a/b' `

`WHERE get_thing_shadow("MyThing","arn:aws:iam::123456789012:role/AllowsThingShadowAccess") .state.reported.alarm = 'ON'`

## Hashing functions<a name="iot-sql-function-hash"></a>

 AWS IoT provides the following hashing functions:
+ md2
+ md5
+ sha1
+ sha224
+ sha256
+ sha384
+ sha512

All hash functions expect one string argument\. The result is the hashed value of that string\. Standard string conversions apply to non\-string arguments\. All hash functions are supported by SQL version 2015\-10\-08 and later\.

Examples:

`md2("hello")` = "a9046c73e00331af68917d3804f70655"

`md5("hello")` = "5d41402abc4b2a76b9719d911017c592"

## indexof\(String, string\)<a name="iot-sql-function-indexof"></a>

Returns the first index \(0\-based\) of the second argument as a substring in the first argument\. Both arguments are expected as strings\. Arguments that are not strings are subjected to standard string conversion rules\. This function does not apply to arrays, only to strings\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`indexof("abcd", "bc") ` = 1

## isNull\(\)<a name="iot-sql-function-isNull"></a>

Returns true if the argument is the `Null` value\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`isNull(5) ` = false\.

`isNull(Null) ` = true\.


****  

| Argument type | Result | 
| --- | --- | 
| Int | false | 
| Decimal | false | 
| Boolean | false | 
| String | false | 
| Array | false | 
| Object | false | 
| Null | true | 
| Undefined | false | 

## isUndefined\(\)<a name="iot-sql-function-isUndefined"></a>

Returns true if the argument is `Undefined`\. Supported by SQL version 2016\-03\-23 and later\.

Examples:

`isUndefined(5) ` = false\.

`isUndefined(floor([1,2,3]))) ` = true\.


****  

| Argument type | Result | 
| --- | --- | 
| Int | false | 
| Decimal | false | 
| Boolean | false | 
| String | false | 
| Array | false | 
| Object | false | 
| Null | false | 
| Undefined | true | 

## length\(String\)<a name="iot-sql-function-length"></a>

Returns the number of characters in the provided string\. Standard conversion rules apply to non\-`String` arguments\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`length("hi")` = 2

`length(false)` = 5

## ln\(Decimal\)<a name="iot-func-nln"></a>

Returns the natural logarithm of the argument\. `Decimal` arguments are rounded to double precision before function application\. Supported by SQL version 2015\-10\-08 and later\.

Example: `ln(e)` = 1\. 


****  

| Argument type | Result | 
| --- | --- | 
| Int | Decimal \(with double precision\), the natural log of the argument\. | 
| Decimal | Decimal \(with double precision\), the natural log of the argument\. | 
| Boolean | Undefined\. | 
| String | Decimal \(with double precision\), the natural log of the argument\. If the string cannot be converted to a Decimal, the result is Undefined\.  | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## log\(Decimal\)<a name="iot-func-log"></a>

Returns the base 10 logarithm of the argument\. `Decimal` arguments are rounded to double precision before function application\. Supported by SQL version 2015\-10\-08 and later\.

Example: `log(100)` = 2\.0\. 


****  

| Argument type | Result | 
| --- | --- | 
| Int | Decimal \(with double precision\), the base 10 log of the argument\. | 
| Decimal | Decimal \(with double precision\), the base 10 log of the argument\. | 
| Boolean | Undefined\. | 
| String | Decimal \(with double precision\), the base 10 log of the argument\. If the String cannot be converted to a Decimal, the result is Undefined\.  | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## lower\(String\)<a name="iot-func-lower"></a>

Returns the lowercase version of the given `String`\. Non\-string arguments are converted to strings using the standard conversion rules\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`lower("HELLO")` = "hello"\.

`lower(["HELLO"])` = "\[\\"hello\\"\]"\.

## lpad\(String, int\)<a name="iot-func-lpad"></a>

Returns the `String` argument, padded on the left side with the number of spaces specified by the second argument\. The `Int` argument must be between 0 and 1000\. If the provided value is outside of this valid range, the argument is set to the nearest valid value \(0 or 1000\)\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`lpad("hello", 2)` = " hello"\.

`lpad(1, 3)` = " 1"


****  

| Argument type 1 | Argument type 2 | Result | 
| --- | --- | --- | 
| String | Int | String, the provided String padded on the left side with a number of spaces equal to the provided Int\. | 
| String | Decimal | The Decimal argument is rounded down to the nearest Int and the String is padded on the left with the specified number of spaces\.  | 
| String | String | The second argument is converted to a Decimal, which is rounded down to the nearest Int, and the String is padded with the specified number spaces on the left\. If the second argument cannot be converted to an Int, the result is Undefined\.  | 
| Other Value | Int/Decimal/String | The first value is converted to a String using the standard conversions, and then the LPAD function is applied on that String\. If it cannot be converted, the result is Undefined\. | 
| Any Value | Other Value | Undefined\. | 

## ltrim\(String\)<a name="iot-func-ltrim"></a>

Removes all leading white space \(tabs and spaces\) from the provided `String`\. Supported by SQL version 2015\-10\-08 and later\.

Example:

`Ltrim(" h i ")` = "hi "\.


****  

| Argument type | Result | 
| --- | --- | 
| Int | The String representation of the Int with all leading white space removed\. | 
| Decimal | The String representation of the Decimal with all leading white space removed\. | 
| Boolean | The String representation of the boolean \("true" or "false"\) with all leading white space removed\. | 
| String | The argument with all leading white space removed\. | 
| Array | The String representation of the Array \(using standard conversion rules\) with all leading white space removed\. | 
| Object | The String representation of the Object \(using standard conversion rules\) with all leading white space removed\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## machinelearning\_predict\(modelId\)<a name="iot-sql-function-machine-learning"></a>

Use the `machinelearning_predict` function to make predictions using the data from an MQTT message based on an Amazon Machine Learning \(Amazon ML\) model\. Supported by SQL version 2015\-10\-08 and later\. The arguments for the `machinelearning_predict` function are:

modelId  
The ID of the model against which to run the prediction\. The real\-time endpoint of the model must be enabled\.

roleArn  
The IAM role that has a policy with `machinelearning:Predict` and `machinelearning:GetMLModel` permissions and allows access to the model against which the prediction is run\.

record  
The data to be passed into the Amazon ML Predict API\. This should be represented as a single layer JSON object\. If the record is a multi\-level JSON object, the record is flattened by serializing its values\. For example, the following JSON:  

```
{ "key1": {"innerKey1": "value1"}, "key2": 0}
```
 would become:  

```
{ "key1": "{\"innerKey1\": \"value1\"}", "key2": 0}
```

The function returns a JSON object with the following fields:

predictedLabel  
The classification of the input based on the model\.

details  
Contains the following attributes:    
PredictiveModelType  
The model type\. Valid values are REGRESSION, BINARY, MULTICLASS\.  
Algorithm  
The algorithm used by Amazon ML to make predictions\. The value must be SGD\.

predictedScores  
Contains the raw classification score corresponding to each label\.

predictedValue  
The value predicted by Amazon ML\.

## mod\(Decimal, decimal\)<a name="iot-func-mod"></a>

Returns the remainder of the division of the first argument by the second argument\. Equivalent to [remainder\(Decimal, decimal\)](#iot-func-remainder)\. You can also use "%" as an infix operator for the same modulo functionality\. Supported by SQL version 2015\-10\-08 and later\.

Example: `mod(8, 3)` = 2\.


****  

| Left operand | Right operand | Output | 
| --- | --- | --- | 
| Int | Int | Int, the first argument modulo the second argument\. | 
| Int/Decimal | Int/Decimal | Decimal, the first argument modulo the second operand\. | 
| String/Int/Decimal | String/Int/Decimal | If all strings convert to decimals, the result is the first argument modulo the second argument\. Otherwise, Undefined\. | 
| Other Value | Other Value | Undefined\. | 

## nanvl\(AnyValue, AnyValue\)<a name="iot-func-nanvl"></a>

Returns the first argument if it is a valid `Decimal`\. Otherwise, the second argument is returned\. Supported by SQL version 2015\-10\-08 and later\. 

Example: `Nanvl(8, 3)` = 8\.


****  

| Argument type 1 | Argument type 2 | Output | 
| --- | --- | --- | 
| Undefined | Any Value | The second argument\. | 
| Null | Any Value | The second argument\. | 
| Decimal \(NaN\) | Any Value | The second argument\. | 
| Decimal \(not NaN\) | Any Value | The first argument\. | 
| Other Value | Any Value | The first argument\. | 

## Newuuid\(\)<a name="iot-sql-function-newuuid"></a>

Returns a random 16\-byte UUID\. Supported by SQL version 2015\-10\-08 and later\.

Example: `newuuid()` = `123a4567-b89c-12d3-e456-789012345000`

## numbytes\(String\)<a name="iot-sql-function-numbytes"></a>

Returns the number of bytes in the UTF\-8 encoding of the provided string\. Standard conversion rules apply to non\-`String` arguments\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`numbytes("hi")` = 2

`numbytes("€") ` = 3

## Principal\(\)<a name="iot-sql-function-principal"></a>

Returns the principal the device uses for authentication\. Which principal is return depends on how the triggering message was published\. The following table describes the principal returned for each publishing method and protocol\.


****  

| How message is published | Protocol | Credential type | Principal | 
| --- | --- | --- | --- | 
| MQTT client | MQTT | X\.509 device certificate | X\.509 certificate thumbprint | 
| AWS IoT console MQTT client | MQTT | IAM user or role | <iam\-role\-id>:<session\-name> | 
| AWS CLI | HTTP | IAM user or role | <userid> | 
| AWS IoT Device SDK | MQTT | X\.509 device certificate | X\.509 certificate thumbprint | 
| AWS IoT Device SDK | MQTT over WebSocket | IAM user or role | <userid> | 

The following examples show the different types of values returned by `principal`:
+ X\.509 certificate thumbprint: `ba67293af50bf2506f5f93469686da660c7c844e7b3950bfb16813e0d31e9373`
+ IAM role ID and session name: `ABCD1EFG3HIJK2LMNOP5:my-session-name`
+ returns a user ID: `ABCD1EFG3HIJK2LMNOP5`

## parse\_time\(String, long, \[string\]\)<a name="iot-sql-function-parse-time"></a>

Use the `parse_time` function to format a timestamp into a human\-readable date/time format\. Supported by SQL version 2016\-03\-23 and later\. The arguments for the `parse_time` function are:

pattern  
\(String\) A date/time pattern that conforms to the [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) standard format\. \(Specifically, the function supports [Joda\-Time formats](http://www.joda.org/joda-time/apidocs/org/joda/time/format/DateTimeFormat.html)\.\) 

timestamp  
\(Long\) The time to be formatted in milliseconds since Unix epoch\. See function [Timestamp\(\)](#iot-function-timestamp)\.

timezone  
\(String\) Optional\. The time zone of the formatted date/time\. The default is "UTC"\. The function supports [Joda\-Time time zones](http://joda-time.sourceforge.net/timezones.html)\.

Examples:

When this message is published to the topic 'A/B', the payload `{"ts": "1970.01.01 AD at 21:46:40 CST"}` is sent to the S3 bucket:

```
{
    "ruleArn": "arn:aws:iot:us-east-2:ACCOUNT_ID:rule/RULE_NAME",
    "topicRulePayload": {
        "sql": "SELECT parse_time("yyyy.MM.dd G 'at' HH:mm:ss z", 100000000, "America/Belize" ) as ts FROM 'A/B'",

        "ruleDisabled": false,
        "awsIotSqlVersion": "2016-03-23",
        "actions": [
            {
                "s3": {
                    "roleArn": "arn:aws:iam::ACCOUNT_ID:rule:role/ROLE_NAME",
                    "bucketName": "BUCKET_NAME",
                    "key": "KEY_NAME"
                }
            }
        ],
        "ruleName": "RULE_NAME"
    }
}
```

When this message is published to the topic 'A/B', a payload similar to `{"ts": "2017.06.09 AD at 17:19:46 UTC"}` \(but with the current date/time\) is sent to the S3 bucket:

```
{
    "ruleArn": "arn:aws:iot:us-east-2:ACCOUNT_ID:rule/RULE_NAME",
    "topicRulePayload": {
        "sql": "SELECT parse_time("yyyy.MM.dd G 'at' HH:mm:ss z", timestamp() ) as ts FROM 'A/B'",
        "awsIotSqlVersion": "2016-03-23",
        "ruleDisabled": false,
        "actions": [
            {
                "s3": {
                    "roleArn": "arn:aws:iam::ACCOUNT_ID:rule:role/ROLE_NAME",
                    "bucketName": "BUCKET_NAME",
                    "key": "KEY_NAME"
                }
            }
        ],
        "ruleName": "RULE_NAME"
    }
}
```

`parse_time()` can also be used as a substitution template\. For example, when this message is published to the topic 'A/B', the payload is sent to the S3 bucket with key = "2017":

```
{
    "ruleArn": "arn:aws:iot:us-east-2:ACCOUNT_ID:rule/RULE_NAME",
    "topicRulePayload": {
        "sql": "SELECT * FROM 'A/B'",
        "awsIotSqlVersion": "2016-03-23",
        "ruleDisabled": false,
        "actions": [
            {
                "s3": {
                    "roleArn": "arn:aws:iam::ACCOUNT_ID:rule:role/ROLE_NAME",
                    "bucketName": BUCKET_NAME,
                    "key": "${parse_time("yyyy", timestamp(), "UTC")}"
                }
            }
        ],
        "ruleName": "RULE_NAME"
    }
}
```

## power\(Decimal, decimal\)<a name="iot-func-power"></a>

Returns the first argument raised to the second argument\. `Decimal` arguments are rounded to double precision before function application\. Supported by SQL version 2015\-10\-08 and later\. Supported by SQL version 2015\-10\-08 and later\.

Example: `power(2, 5)` = 32\.0\.


****  

| Argument type 1 | Argument type 2 | Output | 
| --- | --- | --- | 
| Int/Decimal | Int/Decimal | A Decimal \(with double precision\), the first argument raised to the second argument's power\. | 
| Int/Decimal/String | Int/Decimal/String | A Decimal \(with double precision\), the first argument raised to the second argument's power\. Any strings are converted to decimals\. If any String fails to be converted to Decimal, the result is Undefined\. | 
| Other Value | Other Value | Undefined\. | 

## Rand\(\)<a name="iot-sql-function-rand"></a>

Returns a pseudorandom, uniformly distributed double between 0\.0 and 1\.0\. Supported by SQL version 2015\-10\-08 and later\.

Example:

`rand()` = 0\.8231909191640703

## regexp\_matches\(String, string\)<a name="iot-func-regex-matches"></a>

Returns true if the string \(first argument\) contains a match for the regular expression \(second argument\)\.

Example:

`regexp_matches("aaaa", "a{2,}") ` = true\.

`regexp_matches("aaaa", "b")` = false\.


**First argument:**  

| Argument type | Result | 
| --- | --- | 
| Int | The String representation of the Int\. | 
| Decimal | The String representation of the Decimal\. | 
| Boolean | The String representation of the boolean \("true" or "false"\)\. | 
| String | The String\. | 
| Array | The String representation of the Array \(using standard conversion rules\)\. | 
| Object | The String representation of the Object \(using standard conversion rules\)\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

*Second argument:*

Must be a valid regex expression\. Non\-string types are converted to `String` using the standard conversion rules\. Depending on the type, the resultant string might not be a valid regular expression\. If the \(converted\) argument is not valid regex, the result is `Undefined`\. 

## regexp\_replace\(String, string, string\)<a name="iot-func-regex-replace"></a>

Replaces all occurrences of the second argument \(regular expression\) in the first argument with the third argument\. Reference capture groups with "$"\. Supported by SQL version 2015\-10\-08 and later\.

Example:

`regexp_replace("abcd", "bc", "x")` = "axd"\.

`regexp_replace("abcd", "b(.*)d", "$1")` = "ac"\.


**First argument:**  

| Argument type | Result | 
| --- | --- | 
| Int | The String representation of the Int\. | 
| Decimal | The String representation of the Decimal\. | 
| Boolean | The String representation of the boolean \("true" or "false"\)\. | 
| String | The source value\. | 
| Array | The String representation of the Array \(using standard conversion rules\)\. | 
| Object | The String representation of the Object \(using standard conversion rules\)\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

*Second argument:*

Must be a valid regex expression\. Non\-string types are converted to `String` using the standard conversion rules\. Depending on the type, the resultant string might not be a valid regular expression\. If the \(converted\) argument is not a valid regex expression, the result is `Undefined`\. 

*Third argument:*

Must be a valid regex replacement string\. \(Can reference capture groups\.\) Non\-string types are converted to `String` using the standard conversion rules\. If the \(converted\) argument is not a valid regex replacement string, the result is `Undefined`\. 

## regexp\_substr\(String, string\)<a name="iot-func-regex-substr"></a>

Finds the first match of the second parameter \(regex\) in the first parameter\. Reference capture groups with "$"\. Supported by SQL version 2015\-10\-08 and later\.

Example:

`regexp_substr("hihihello", "hi")` = "hi"

`regexp_substr("hihihello", "(hi)*")` = "hihi"


**First argument:**  

| Argument type | Result | 
| --- | --- | 
| Int | The String representation of the Int\. | 
| Decimal | The String representation of the Decimal\. | 
| Boolean | The String representation of the boolean \("true" or "false"\)\. | 
| String | The String argument\. | 
| Array | The String representation of the Array \(using standard conversion rules\)\. | 
| Object | The String representation of the Object \(using standard conversion rules\)\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

*Second argument:*

Must be a valid regex expression\. Non\-string types are converted to `String` using the standard conversion rules\. Depending on the type, the resultant string might not be a valid regular expression\. If the \(converted\) argument is not a valid regex expression, the result is `Undefined`\. 

*Third argument:*

Must be a valid regex replacement string\. \(Can reference capture groups\.\) Non\-string types are converted to `String` using the standard conversion rules\. If the argument is not a valid regex replacement string, the result is `Undefined`\. 

## remainder\(Decimal, decimal\)<a name="iot-func-remainder"></a>

Returns the remainder of the division of the first argument by the second argument\. Equivalent to [mod\(Decimal, decimal\)](#iot-func-mod)\. You can also use "%" as an infix operator for the same modulo functionality\. Supported by SQL version 2015\-10\-08 and later\.

Example: `remainder(8, 3)` = 2\.


****  

| Left operand | Right operand | Output | 
| --- | --- | --- | 
| Int | Int | Int, the first argument modulo the second argument\. | 
| Int/Decimal | Int/Decimal | Decimal, the first argument modulo the second operand\. | 
| String/Int/Decimal | String/Int/Decimal | If all strings convert to decimals, the result is the first argument modulo the second argument\. Otherwise, Undefined\. | 
| Other Value | Other Value | Undefined\. | 

## replace\(String, string, string\)<a name="iot-func-replace"></a>

Replaces all occurrences of the second argument in the first argument with the third argument\. Supported by SQL version 2015\-10\-08 and later\.

Example:

`replace("abcd", "bc", "x")` = `"axd"`\.

`replace("abcdabcd", "b", "x")` = `"afcdafcd"`\.


**All arguments**  

| Argument type | Result | 
| --- | --- | 
| Int | The String representation of the Int\. | 
| Decimal | The String representation of the Decimal\. | 
| Boolean | The String representation of the boolean \("true" or "false"\)\. | 
| String | The source value\. | 
| Array | The String representation of the Array \(using standard conversion rules\)\. | 
| Object | The String representation of the Object \(using standard conversion rules\)\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## rpad\(String, int\)<a name="iot-func-rpad"></a>

Returns the string argument, padded on the right side with the number of spaces specified in the second argument\. The `Int` argument must be between 0 and 1000\. If the provided value is outside of this valid range, the argument is set to the nearest valid value \(0 or 1000\)\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`rpad("hello", 2)` = "hello "\.

`rpad(1, 3)` = "1 "\.


****  

| Argument type 1 | Argument type 2 | Result | 
| --- | --- | --- | 
| String | Int | The String is padded on the right side with a number of spaces equal to the provided Int\. | 
| String | Decimal | The Decimal argument is rounded down to the nearest Int and the string is padded on the right side with a number of spaces equal to the provided Int\. | 
| String | String | The second argument is converted to a Decimal, which is rounded down to the nearest Int\. The String is padded on the right side with a number of spaces equal to the Int value\. | 
| Other Value | Int/Decimal/String | The first value is converted to a String using the standard conversions, and the rpad function is applied on that String\. If it cannot be converted, the result is Undefined\. | 
| Any Value | Other Value | Undefined\. | 

## round\(Decimal\)<a name="iot-func-round"></a>

Rounds the given `Decimal` to the nearest `Int`\. If the `Decimal` is equidistant from two `Int` values \(for example, 0\.5\), the `Decimal` is rounded up\. Supported by SQL version 2015\-10\-08 and later\.

Example: `Round(1.2)` = 1\.

`Round(1.5)` = 2\.

`Round(1.7)` = 2\.

`Round(-1.1)` = \-1\.

`Round(-1.5)` = \-2\.


****  

| Argument type | Result | 
| --- | --- | 
| Int | The argument\. | 
| Decimal | Decimal is rounded down to the nearest Int\. | 
| String | Decimal is rounded down to the nearest Int\. If the string cannot be converted to a Decimal, the result is Undefined\. | 
| Other Value | Undefined\. | 

## rtrim\(String\)<a name="iot-func-rtrim"></a>

Removes all trailing white space \(tabs and spaces\) from the provided `String`\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`rtrim(" h i ")` = " h i"


****  

| Argument type | Result | 
| --- | --- | 
| Int | The String representation of the Int\. | 
| Decimal | The String representation of the Decimal\. | 
| Boolean | The String representation of the boolean \("true" or "false"\)\. | 
| Array | The String representation of the Array \(using standard conversion rules\)\. | 
| Object | The String representation of the Object \(using standard conversion rules\)\. | 
| Null | Undefined\. | 
| Undefined | Undefined | 

## sign\(Decimal\)<a name="iot-func-sign"></a>

Returns the sign of the given number\. When the sign of the argument is positive, 1 is returned\. When the sign of the argument is negative, \-1 is returned\. If the argument is 0, 0 is returned\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`sign(-7)` = \-1\.

`sign(0)` = 0\.

`sign(13)` = 1\.


****  

| Argument type | Result | 
| --- | --- | 
| Int | Int, the sign of the Int value\. | 
| Decimal | Int, the sign of the Decimal value\. | 
| String | Int, the sign of the Decimal value\. The string is converted to a Decimal value, and the sign of the Decimal value is returned\. If the String cannot be converted to a Decimal, the result is Undefined\. Supported by SQL version 2015\-10\-08 and later\. | 
| Other Value | Undefined\. | 

## sin\(Decimal\)<a name="iot-func-sin"></a>

Returns the sine of a number in radians\. `Decimal` arguments are rounded to double precision before function application\. Supported by SQL version 2015\-10\-08 and later\.

Example: `sin(0)` = 0\.0


****  

| Argument type | Result | 
| --- | --- | 
| Int | Decimal \(with double precision\), the sine of the argument\. | 
| Decimal | Decimal \(with double precision\), the sine of the argument\. | 
| Boolean | Undefined\. | 
| String | Decimal \(with double precision\), the sine of the argument\. If the string cannot be converted to a Decimal, the result is Undefined\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## sinh\(Decimal\)<a name="iot-func-sinh"></a>

Returns the hyperbolic sine of a number\. `Decimal` values are rounded to double precision before function application\. The result is a `Decimal` value of double precision\. Supported by SQL version 2015\-10\-08 and later\.

Example: `sinh(2.3)` = 4\.936961805545957


****  

| Argument type | Result | 
| --- | --- | 
| Int | Decimal \(with double precision\), the hyperbolic sine of the argument\. | 
| Decimal | Decimal \(with double precision\), the hyperbolic sine of the argument\. | 
| Boolean | Undefined\. | 
| String | Decimal \(with double precision\), the hyperbolic sine of the argument\. If the string cannot be converted to a Decimal, the result is Undefined\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## substring\(String, int \[, int\]\)<a name="iot-func-substring"></a>

Expects a `String` followed by one or two `Int` values\. For a `String` and a single `Int` argument, this function returns the substring of the provided `String` from the provided `Int` index \(0\-based, inclusive\) to the end of the `String`\. For a `String` and two `Int` arguments, this function returns the substring of the provided `String` from the first `Int` index argument \(0\-based, inclusive\) to the second `Int` index argument \(0\-based, exclusive\)\. Indices that are less than zero are set to zero\. Indices that are greater than the `String` length are set to the `String` length\. For the three argument version, if the first index is greater than \(or equal to\) the second index, the result is the empty `String`\.

 If the arguments provided are not \(*String*, *Int*\), or \(*String*, *Int*, *Int*\), the standard conversions are applied to the arguments to attempt to convert them into the correct types\. If the types cannot be converted, the result of the function is `Undefined`\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`substring("012345", 0)` = "012345"\.

`substring("012345", 2)` = "2345"\.

`substring("012345", 2.745)` = "2345"\.

`substring(123, 2)` = "3"\.

`substring("012345", -1)` = "012345"\.

`substring(true, 1.2)` = "rue"\.

`substring(false, -2.411E247)` = "false"\.

`substring("012345", 1, 3)` = "12"\.

`substring("012345", -50, 50)` = "012345"\.

`substring("012345", 3, 1)` = ""\.

## sql\_version\(\)<a name="iot-sql-function-sql-version"></a>

Returns the SQL version specified in this rule\. Supported by SQL version 2015\-10\-08 and later\.

Example:

`sql_version()` = "2016\-03\-23"

## sqrt\(Decimal\)<a name="iot-func-sqrt"></a>

Returns the square root of a number\. `Decimal` arguments are rounded to double precision before function application\. Supported by SQL version 2015\-10\-08 and later\.

Example: `sqrt(9)` = 3\.0\.


****  

| Argument type | Result | 
| --- | --- | 
| Int | The square root of the argument\. | 
| Decimal | The square root of the argument\. | 
| Boolean | Undefined\. | 
| String | The square root of the argument\. If the string cannot be converted to a Decimal, the result is Undefined\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## startswith\(String, string\)<a name="iot-func-startswith"></a>

Returns `Boolean`, whether the first string argument starts with the second string argument\. If either argument is `Null` or `Undefined`, the result is `Undefined`\. Supported by SQL version 2015\-10\-08 and later\.

Example:

`startswith("ranger","ran")` = true


****  

| Argument type 1 | Argument type 2 | Result | 
| --- | --- | --- | 
| String | String | Whether the first string starts with the second string\. | 
| Other Value | Other Value | Both arguments are converted to strings using the standard conversion rules\. Returns true if the first string starts with the second string\. If either argument is Null or Undefined, the result is Undefined\. | 

## tan\(Decimal\)<a name="iot-func-tan"></a>

Returns the tangent of a number in radians\. `Decimal` values are rounded to double precision before function application\. Supported by SQL version 2015\-10\-08 and later\.

Example: `tan(3)` = \-0\.1425465430742778


****  

| Argument type | Result | 
| --- | --- | 
| Int | Decimal \(with double precision\), the tangent of the argument\. | 
| Decimal | Decimal \(with double precision\), the tangent of the argument\. | 
| Boolean | Undefined\. | 
| String | Decimal \(with double precision\), the tangent of the argument\. If the string cannot be converted to a Decimal, the result is Undefined\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## tanh\(Decimal\)<a name="iot-func-tanh"></a>

Returns the hyperbolic tangent of a number in radians\. `Decimal` values are rounded to double precision before function application\. Supported by SQL version 2015\-10\-08 and later\.

Example: `tanh(2.3)` = 0\.9800963962661914


****  

| Argument type | Result | 
| --- | --- | 
| Int | Decimal \(with double precision\), the hyperbolic tangent of the argument\. | 
| Decimal | Decimal \(with double precision\), the hyperbolic tangent of the argument\. | 
| Boolean | Undefined\. | 
| String | Decimal \(with double precision\), the hyperbolic tangent of the argument\. If the string cannot be converted to a Decimal, the result is Undefined\. | 
| Array | Undefined\. | 
| Object | Undefined\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## Timestamp\(\)<a name="iot-function-timestamp"></a>

Returns the current timestamp in milliseconds from 00:00:00 Coordinated Universal Time \(UTC\), Thursday, 1 January 1970, as observed by the AWS IoT rules engine\. Supported by SQL version 2015\-10\-08 and later\.

Example: `timestamp()` = `1481825251155`

## topic\(Decimal\)<a name="iot-function-topic"></a>

Returns the topic to which the message that triggered the rule was sent\. If no parameter is specified, the entire topic is returned\. The `Decimal` parameter is used to specify a specific topic segment, with 1 designating the first segment\. For the topic `foo/bar/baz`, topic\(1\) returns `foo`, topic\(2\) returns `bar`, and so on\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`topic()` = "things/myThings/thingOne"

`topic(1)` = "things"

When [Basic Ingest](iot-basic-ingest.md) is used, the initial prefix of the topic \(`$aws/rules/rule-name`\) is not available to the topic\(\) function\. For example, given the topic:

`$aws/rules/BuildingManager/Buildings/Building5/Floor2/Room201/Lights`

`topic()` = "Buildings/Building5/Floor2/Room201/Lights"

`topic(3)` = "Floor2"

## Traceid\(\)<a name="iot-sql-function-traceid"></a>

Returns the trace ID \(UUID\) of the MQTT message, or `Undefined` if the message wasn't sent over MQTT\. Supported by SQL version 2015\-10\-08 and later\.

Example:

`traceid() ` = "12345678\-1234\-1234\-1234\-123456789012"

## trunc\(Decimal, int\)<a name="iot-func-trunc"></a>

Truncates the first argument to the number of `Decimal` places specified by the second argument\. If the second argument is less than zero, it is set to zero\. If the second argument is greater than 34, it is set to 34\. Trailing zeroes are stripped from the result\. Supported by SQL version 2015\-10\-08 and later\.

Examples: 

`trunc(2.3, 0)` = 2\.

`trunc(2.3123, 2)` = 2\.31\.

`trunc(2.888, 2)` = 2\.88\.

`trunc(2.00, 5)` = 2\.


****  

| Argument type 1 | Argument type 2 | Result | 
| --- | --- | --- | 
| Int | Int | The source value\. | 
| Int/Decimal | Int/Decimal | The first argument is truncated to the length described by the second argument\. The second argument, if not an Int, is rounded down to the nearest Int\. | 
| Int/Decimal/String | Int/Decimal | The first argument is truncated to the length described by the second argument\. The second argument, if not an Int, is rounded down to the nearest Int\. A String is converted to a Decimal value\. If the string conversion fails, the result is Undefined\. | 
| Other Value |  | Undefined\. | 

## trim\(String\)<a name="iot-func-trim"></a>

Removes all leading and trailing white space from the provided `String`\. Supported by SQL version 2015\-10\-08 and later\.

Example:

`Trim(" hi ") ` = "hi"


****  

| Argument type | Result | 
| --- | --- | 
| Int | The String representation of the Int with all leading and trailing white space removed\. | 
| Decimal | The String representation of the Decimal with all leading and trailing white space removed\. | 
| Boolean | The String representation of the Boolean \("true" or "false"\) with all leading and trailing white space removed\. | 
| String | The String with all leading and trailing white space removed\. | 
| Array | The String representation of the Array using standard conversion rules\. | 
| Object | The String representation of the Object using standard conversion rules\. | 
| Null | Undefined\. | 
| Undefined | Undefined\. | 

## upper\(String\)<a name="iot-sql-function-upper"></a>

Returns the uppercase version of the given `String`\. Non\-`String` arguments are converted to `String` using the standard conversion rules\. Supported by SQL version 2015\-10\-08 and later\.

Examples:

`upper("hello")` = "HELLO"

`upper(["hello"])` = "\[\\"HELLO\\"\]"